<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¶ˆé˜²éšæ‚£æ¶ˆæ¶ˆä¹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        fire: {
                            blue: '#1E5A8A',     // ç«ç„°è“ä¸»è‰²
                            light: '#3598DB',    // ç«ç„°è“æµ…è‰²
                            accent: '#FF5722',   // ç«ç„°æ©™å¼ºè°ƒè‰²
                            dark: '#0F3057',     // ç«ç„°è“æ·±è‰²
                            card: '#F0F7FF',     // ç»Ÿä¸€å¡ç‰‡èƒŒæ™¯è‰²
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-hover {
                transition: all 0.2s ease;
            }
            .card-hover:active {
                transform: scale(0.95);
            }
            .remove-animation {
                animation: remove 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            }
            @keyframes remove {
                0% { opacity: 1; transform: scale(1); }
                50% { opacity: 0.7; transform: scale(1.05); }
                100% { opacity: 0; transform: scale(0); }
            }
            .error-shake {
                animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            }
            @keyframes shake {
                10%, 90% { transform: translateX(-1px); }
                20%, 80% { transform: translateX(2px); }
                30%, 50%, 70% { transform: translateX(-2px); }
                40%, 60% { transform: translateX(2px); }
            }
            .gradient-bg {
                background: linear-gradient(180deg, #1E5A8A 0%, #3598DB 100%);
            }
            .text-shadow {
                text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            }
            .card-glow {
                box-shadow: 0 0 10px rgba(53, 152, 219, 0.3);
            }
            .sound-control {
                position: absolute;
                top: 12px;
                right: 12px;
                z-index: 20;
            }
        }
    </style>
</head>
<body class="bg-fire-dark min-h-screen flex flex-col items-center p-0 m-0">
    <!-- éŸ³æ•ˆå…ƒç´  -->
    <audio id="bgMusic" loop preload="auto" volume="0.2">
        <source src="https://assets.mixkit.co/music/preview/mixkit-tech-house-vibes-130.mp3" type="audio/mpeg">
    </audio>
    <audio id="correctSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" type="audio/mpeg">
    </audio>
    <audio id="errorSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-negative-guitar-tone-232.mp3" type="audio/mpeg">
    </audio>
    
    <!-- æ‰‹æœºä¸»å®¹å™¨ -->
    <div class="relative w-full h-screen overflow-hidden gradient-bg flex flex-col">
        <!-- å£°éŸ³æ§åˆ¶æŒ‰é’® -->
        <div class="sound-control">
            <button id="toggleSound" class="bg-white/20 hover:bg-white/30 text-white w-9 h-9 rounded-full flex items-center justify-center backdrop-blur-sm transition-all">
                <i class="fa fa-volume-up"></i>
            </button>
        </div>
        
        <!-- æ¸¸æˆæ ‡é¢˜åŒº -->
        <div class="pt-12 pb-4 px-4 text-center">
            <h1 class="text-[clamp(1.3rem,5vw,1.8rem)] font-bold text-white flex items-center justify-center text-shadow">
                <i class="fa fa-fire-extinguisher mr-2 animate-pulse"></i>æ¶ˆé˜²éšæ‚£æ¶ˆæ¶ˆä¹
            </h1>
            <p class="text-blue-100 mt-1 text-sm">è¯†åˆ«éšæ‚£ï¼Œå®ˆæŠ¤å®‰å…¨ï¼</p>
        </div>
        
        <!-- æ¸¸æˆçŠ¶æ€é¢æ¿ -->
        <div class="bg-white/90 backdrop-blur-sm rounded-xl p-3 mx-4 mb-4 shadow-md">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-fire-blue flex items-center justify-center text-white mr-2">
                        <i class="fa fa-clock-o text-sm"></i>
                    </div>
                    <span class="text-fire-dark text-sm">ç”¨æ—¶: <span id="timer" class="font-bold text-fire-blue">00:00</span></span>
                </div>
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-fire-accent flex items-center justify-center text-white mr-2">
                        <i class="fa fa-star text-sm"></i>
                    </div>
                    <span class="text-fire-dark text-sm">åˆ†æ•°: <span id="score" class="font-bold text-fire-accent">0</span></span>
                </div>
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-red-500 flex items-center justify-center text-white mr-2">
                        <i class="fa fa-exclamation-circle text-sm"></i>
                    </div>
                    <span class="text-fire-dark text-sm">å‰©ä½™: <span id="remaining" class="font-bold text-red-500">8</span></span>
                </div>
            </div>
        </div>
        
        <!-- æ¸¸æˆæ§åˆ¶æŒ‰é’® -->
        <div class="flex gap-3 mx-4 mb-4">
            <button id="startBtn" class="flex-1 bg-fire-accent hover:bg-fire-accent/90 text-white py-3 px-4 rounded-lg transition-all flex items-center justify-center shadow-md">
                <i class="fa fa-play mr-2"></i>å¼€å§‹æ¸¸æˆ
            </button>
            <button id="resetBtn" class="flex-1 bg-fire-dark hover:bg-fire-dark/90 text-white py-3 px-4 rounded-lg transition-all flex items-center justify-center shadow-md">
                <i class="fa fa-refresh mr-2"></i>é‡ç½®
            </button>
        </div>
        
        <!-- æ¸¸æˆç½‘æ ¼åŒºåŸŸï¼ˆ3åˆ—å¸ƒå±€ï¼Œé€‚åˆæ‰‹æœºï¼‰ -->
        <div class="flex-1 overflow-y-auto px-3 pb-4">
            <div id="gameGrid" class="grid grid-cols-3 gap-2.5">
                <!-- å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- åº•éƒ¨ä¿¡æ¯æ¡ -->
        <div class="bg-fire-dark/70 text-white/80 text-xs py-2 text-center backdrop-blur-sm">
            <p>æ­£ç¡®+10åˆ† | é”™è¯¯-5åˆ† | ç‚¹å‡»å³ä¸Šè§’å…³é—­å£°éŸ³</p>
        </div>
    </div>
    
    <!-- æ¸¸æˆè¯´æ˜å¼¹çª— -->
    <div id="instructions" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl p-5 w-[90%] max-w-sm shadow-2xl z-50">
        <h3 class="font-bold text-lg text-fire-blue mb-3 flex items-center">
            <i class="fa fa-info-circle mr-2"></i>æ¸¸æˆè¯´æ˜
        </h3>
        <ul class="list-disc pl-5 space-y-1.5 text-gray-700 text-sm">
            <li>åˆ¤æ–­åœºæ™¯æ˜¯å¦ä¸ºæ¶ˆé˜²éšæ‚£</li>
            <li>ç‚¹å‡»ç§»é™¤æ‚¨è®¤ä¸ºçš„éšæ‚£</li>
            <li>æ­£ç¡®è¯†åˆ«ï¼š+10åˆ†å¹¶ç§»é™¤å¡ç‰‡</li>
            <li>è¯¯åˆ¤ééšæ‚£ï¼š-5åˆ†å¹¶æç¤º</li>
            <li>ç§»é™¤æ‰€æœ‰éšæ‚£å³å¯è·èƒœ</li>
        </ul>
        <button id="closeInstructions" class="mt-4 w-full bg-fire-blue hover:bg-fire-blue/90 text-white py-2.5 rounded-lg transition-all">
            å¼€å§‹æ¸¸æˆ
        </button>
    </div>

    <script>
        // éŸ³æ•ˆæ§åˆ¶å˜é‡
        let soundEnabled = true;
        
        // è·å–éŸ³æ•ˆå…ƒç´ 
        const bgMusic = document.getElementById('bgMusic');
        const correctSound = document.getElementById('correctSound');
        const errorSound = document.getElementById('errorSound');
        const toggleSoundBtn = document.getElementById('toggleSound');
        
        // æ¸¸æˆé…ç½®ï¼ˆæ‰‹æœºé€‚é…ï¼š3åˆ—5è¡Œå…±15ä¸ªå¡ç‰‡ï¼‰
        const config = {
            gridSize: { cols: 3, rows: 5 },  // 3åˆ—5è¡Œç½‘æ ¼ï¼ˆé€‚åˆæ‰‹æœºï¼‰
            totalHazards: 8,                 // éšæ‚£æ€»æ•°ï¼ˆå‡å°‘éš¾åº¦é€‚åº”æ‰‹æœºï¼‰
            hazardScore: 10,                 // æ­£ç¡®ç§»é™¤éšæ‚£å¾—åˆ†
            errorPenalty: 5,                 // é”™è¯¯ç§»é™¤æ‰£åˆ†
            maxTime: 300                     // æœ€é•¿æ¸¸æˆæ—¶é—´(ç§’)ï¼ˆç¼©çŸ­é€‚åº”æ‰‹æœºï¼‰
        };

        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            isPlaying: false,
            timer: null,
            timeUsed: 0,
            score: 0,
            removedHazards: 0,
            hazardIndexes: [],    // éšæ‚£æ‰€åœ¨çš„ç´¢å¼•
            removedIndexes: []    // å·²ç§»é™¤çš„ç´¢å¼•
        };

        // DOMå…ƒç´ 
        const gameGrid = document.getElementById('gameGrid');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score');
        const remainingDisplay = document.getElementById('remaining');
        const instructions = document.getElementById('instructions');
        const closeInstructions = document.getElementById('closeInstructions');

        // éšæ‚£åœºæ™¯åº“ï¼ˆç²¾ç®€é€‚åˆæ‰‹æœºæ˜¾ç¤ºï¼‰
        const hazardScenes = [
            { name: 'é€šé“å †ç‰©', icon: 'fa-boxes', desc: 'å µå¡æ¶ˆé˜²é€šé“' },
            { name: 'ç”µçº¿ä¹±æ¥', icon: 'fa-bolt', desc: 'è¿è§„ç§æ‹‰ç”µçº¿' },
            { name: 'æ˜“ç‡ƒç‰©è¿‘ç«', icon: 'fa-fire', desc: 'é è¿‘çƒ­æº' },
            { name: 'ç­ç«å™¨è¿‡æœŸ', icon: 'fa-calendar-times-o', desc: 'å™¨æå¤±æ•ˆ' },
            { name: 'æ¶ˆé˜²æ “é®æŒ¡', icon: 'fa-tint', desc: 'æ— æ³•ä½¿ç”¨' },
            { name: 'å‡ºå£é”é—­', icon: 'fa-lock', desc: 'å®‰å…¨å‡ºå£' },
            { name: 'è¿è§„ç”¨ç”µ', icon: 'fa-plug', desc: 'å¤§åŠŸç‡ç”µå™¨' },
            { name: 'æ˜ç«æ— ç›‘æŠ¤', icon: 'fa-burn', desc: 'ä½œä¸šæ— é˜²æŠ¤' }
        ];

        // å®‰å…¨åœºæ™¯åº“ï¼ˆç²¾ç®€é€‚åˆæ‰‹æœºæ˜¾ç¤ºï¼‰
        const safeScenes = [
            { name: 'é€šé“ç•…é€š', icon: 'fa-road', desc: 'æ— é˜»æŒ¡' },
            { name: 'è§„èŒƒç”¨ç”µ', icon: 'fa-plug', desc: 'ç¬¦åˆæ ‡å‡†' },
            { name: 'ç­ç«å™¨æœ‰æ•ˆ', icon: 'fa-shield', desc: 'å®šæœŸæ£€æŸ¥' },
            { name: 'æ¶ˆé˜²æ “å¯ç”¨', icon: 'fa-water', desc: 'æ— é®æŒ¡' },
            { name: 'å‡ºå£ç•…é€š', icon: 'fa-door-open', desc: 'æ ‡è¯†æ¸…æ™°' },
            { name: 'ç”µçº¿è§„èŒƒ', icon: 'fa-cable-car', desc: 'çº¿è·¯æ•´é½' },
            { name: 'åº”æ€¥ç¯æ­£å¸¸', icon: 'fa-lightbulb-o', desc: 'å¯å·¥ä½œ' },
            { name: 'ç¦çƒŸåŒºåˆè§„', icon: 'fa-ban', desc: 'æ— æ˜ç«' }
        ];

        // æ’­æ”¾éŸ³æ•ˆå‡½æ•°
        function playSound(audioElement) {
            if (soundEnabled) {
                audioElement.currentTime = 0;
                audioElement.play().catch(e => console.log("éŸ³æ•ˆæ’­æ”¾å¤±è´¥:", e));
            }
        }

        // åˆ‡æ¢å£°éŸ³å¼€å…³
        function toggleSound() {
            soundEnabled = !soundEnabled;
            if (soundEnabled) {
                toggleSoundBtn.innerHTML = '<i class="fa fa-volume-up"></i>';
                if (gameState.isPlaying) {
                    bgMusic.play().catch(e => console.log("èƒŒæ™¯éŸ³ä¹æ’­æ”¾å¤±è´¥:", e));
                }
            } else {
                toggleSoundBtn.innerHTML = '<i class="fa fa-volume-off"></i>';
                bgMusic.pause();
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆç½‘æ ¼ï¼ˆæ‰‹æœºé€‚é…ï¼‰
        function initGrid() {
            gameGrid.innerHTML = '';
            gameState.hazardIndexes = [];
            const totalCells = config.gridSize.cols * config.gridSize.rows;
            
            // éšæœºç”Ÿæˆéšæ‚£ä½ç½®ï¼ˆä¸é‡å¤ï¼‰
            while (gameState.hazardIndexes.length < config.totalHazards) {
                const index = Math.floor(Math.random() * totalCells);
                if (!gameState.hazardIndexes.includes(index)) {
                    gameState.hazardIndexes.push(index);
                }
            }

            // ç”Ÿæˆæ‰€æœ‰å¡ç‰‡ï¼ˆæ‰‹æœºè§¦æ§å‹å¥½å°ºå¯¸ï¼‰
            for (let i = 0; i < totalCells; i++) {
                const isHazard = gameState.hazardIndexes.includes(i);
                
                // é€‰æ‹©åœºæ™¯æ•°æ®
                const sceneData = isHazard 
                    ? hazardScenes[Math.floor(Math.random() * hazardScenes.length)]
                    : safeScenes[Math.floor(Math.random() * safeScenes.length)];

                // åˆ›å»ºå¡ç‰‡ï¼ˆé€‚åˆæ‰‹æŒ‡ç‚¹å‡»çš„å°ºå¯¸ï¼‰
                const card = document.createElement('div');
                card.className = `bg-fire-card rounded-lg p-3 shadow-md card-hover card-glow flex flex-col items-center justify-center h-28 cursor-pointer border border-fire-light/20`;
                card.dataset.index = i;
                card.dataset.isHazard = isHazard;
                
                // å¡ç‰‡å†…å®¹ï¼ˆæ‰‹æœºé€‚é…çš„æ–‡å­—å¤§å°ï¼‰
                card.innerHTML = `
                    <i class="fa ${sceneData.icon} text-3xl text-fire-blue mb-1.5"></i>
                    <h3 class="text-center font-medium text-sm mb-0.5">${sceneData.name}</h3>
                    <p class="text-center text-xs text-gray-600">${sceneData.desc}</p>
                `;

                // ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼ˆé€‚åˆè§¦æ‘¸æ“ä½œï¼‰
                card.addEventListener('click', () => handleCardRemoval(card));
                
                gameGrid.appendChild(card);
            }

            updateRemaining();
        }

        // å¤„ç†å¡ç‰‡ç§»é™¤ï¼ˆæ‰‹æœºè§¦æ§åé¦ˆï¼‰
        function handleCardRemoval(card) {
            const index = parseInt(card.dataset.index);
            const isHazard = card.dataset.isHazard === 'true';

            // æ¸¸æˆæœªå¼€å§‹æˆ–å·²ç§»é™¤çš„å¡ç‰‡ä¸å“åº”
            if (!gameState.isPlaying || gameState.removedIndexes.includes(index)) {
                return;
            }

            // åˆ¤æ–­æ˜¯å¦ä¸ºéšæ‚£
            if (isHazard) {
                // æ­£ç¡®ï¼šæ’­æ”¾æˆåŠŸéŸ³æ•ˆ
                playSound(correctSound);
                
                // æ‰§è¡Œç§»é™¤åŠ¨ç”»
                card.classList.add('remove-animation');
                gameState.removedIndexes.push(index);
                gameState.removedHazards++;
                gameState.score += config.hazardScore;

                // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰éšæ‚£éƒ½è¢«ç§»é™¤
                if (gameState.removedHazards === config.totalHazards) {
                    endGame(true);
                }
            } else {
                // é”™è¯¯ï¼šæ’­æ”¾é”™è¯¯éŸ³æ•ˆ
                playSound(errorSound);
                
                // æ‰§è¡Œé”™è¯¯æç¤ºåŠ¨ç”»
                card.classList.add('error-shake');
                gameState.score = Math.max(0, gameState.score - config.errorPenalty);
                
                // ç§»é™¤é”™è¯¯åŠ¨ç”»ç±»
                setTimeout(() => {
                    card.classList.remove('error-shake');
                }, 500);
            }

            // æ›´æ–°æ˜¾ç¤º
            updateScore();
            updateRemaining();
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            // éšè—è¯´æ˜å¼¹çª—
            instructions.classList.add('hidden');
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.isPlaying = true;
            gameState.score = 0;
            gameState.removedHazards = 0;
            gameState.removedIndexes = [];
            gameState.timeUsed = 0;

            // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
            if (soundEnabled) {
                bgMusic.play().catch(e => console.log("èƒŒæ™¯éŸ³ä¹æ’­æ”¾å¤±è´¥:", e));
            }

            // åˆå§‹åŒ–ç½‘æ ¼
            initGrid();

            // å¯åŠ¨è®¡æ—¶å™¨
            if (gameState.timer) clearInterval(gameState.timer);
            gameState.timer = setInterval(() => {
                gameState.timeUsed++;
                updateTimer();
                
                // è¶…æ—¶ç»“æŸ
                if (gameState.timeUsed >= config.maxTime) {
                    endGame(false);
                }
            }, 1000);

            // æ›´æ–°æ˜¾ç¤º
            updateScore();
            startBtn.disabled = true;
            startBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }

        // ç»“æŸæ¸¸æˆ
        function endGame(isWin) {
            clearInterval(gameState.timer);
            gameState.isPlaying = false;
            startBtn.disabled = false;
            startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            
            // æš‚åœèƒŒæ™¯éŸ³ä¹
            bgMusic.pause();

            // æ˜¾ç¤ºç»“æœï¼ˆæ‰‹æœºé€‚é…çš„å¼¹çª—æ–‡å­—ï¼‰
            if (isWin) {
                // èƒœåˆ©ï¼šè®¡ç®—æ—¶é—´å¥–åŠ±
                const timeBonus = Math.max(0, Math.floor((config.maxTime - gameState.timeUsed) / 10));
                gameState.score += timeBonus;
                updateScore();
                alert(`ğŸ‰ æ­å–œè·èƒœï¼\nå¾—åˆ†ï¼š${gameState.score}åˆ†ï¼ˆå«å¥–åŠ±${timeBonus}åˆ†ï¼‰\nç”¨æ—¶ï¼š${formatTime(gameState.timeUsed)}`);
            } else {
                alert(`â° æ—¶é—´åˆ°ï¼\nå·²ç§»é™¤${gameState.removedHazards}/${config.totalHazards}ä¸ªéšæ‚£\nå¾—åˆ†ï¼š${gameState.score}åˆ†`);
            }
        }

        // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimer() {
            timerDisplay.textContent = formatTime(gameState.timeUsed);
        }

        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
        function updateScore() {
            scoreDisplay.textContent = gameState.score;
        }

        // æ›´æ–°å‰©ä½™éšæ‚£æ˜¾ç¤º
        function updateRemaining() {
            remainingDisplay.textContent = config.totalHazards - gameState.removedHazards;
        }

        // ç»‘å®šäº‹ä»¶ï¼ˆé€‚åˆè§¦æ‘¸æ“ä½œï¼‰
        startBtn.addEventListener('click', startGame);
        resetBtn.addEventListener('click', startGame);
        closeInstructions.addEventListener('click', startGame);
        toggleSoundBtn.addEventListener('click', toggleSound);

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            initGrid();
            // æ˜¾ç¤ºæ¸¸æˆè¯´æ˜
            setTimeout(() => {
                instructions.classList.remove('hidden');
            }, 500);
        });
    </script>
</body>
</html>
